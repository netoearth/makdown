![](https://ask.qcloudimg.com/http-save/yehe-5449090/l65t1uf9kp.jpeg?imageView2/2/w/1620)

## **iftop 是什么**

> 在 Linux 系统下即时监控[服务器](https://cloud.tencent.com/product/cvm?from=10680)的网络带宽使用情况，有很多工具，比如 iptraf、nethogs 等等，但是推荐使用小巧但功能很强大的 iftop 工具。

iftop 是 Linux 系统一个免费的网卡实时流量监控工具，类似于 top 命令。iftop 可以监控指定网卡的实时流量、端口连接信息、反向解析 IP 等，还可以精确显示本机网络流量及网络内各主机和本机相互通信的流量集合，非常适合于监控代理服务器或路由器的网络流量。 同时，iftop 对检测流量异常的主机非常有效，通过 iftop 的输出可以迅速定位主机流量异常的根源，这对于网络故障排查、[网络安全](https://cloud.tencent.com/product/ns?from=10680)检测是十分有用的。缺点就是无报表功能，且必须以 root 身份才能运行。

## **安装**

1.  通过软件管理工具安装

1.  通过源代码编译安装

## **常用参数**

## **界面操作**

1.  界面信息

安装完 `iftop` 工具后，直接输入 `iftop` 命令即可显示网卡实时流量信息。在默认情况下，`iftop` 显示系统第一块网卡的流量信息，如果要显示指定网卡信息，可通过`“-i”`参数实现。执行`“iftop -P -i eth0”`命令，得到如下图所示的 `iftop` 的一个典型输出界面。

-   第一部分
    -   iftop 输出中最上面的一行，此行信息是流量刻度，用于显示网卡带宽流量。
-   第二部分
    -   此部分为分割线中间的部分，其中又分别分为左、中、右三列。左列和中列，记录了哪些 IP 或主机正在和本机的网络进行连接。其中，中列的“=>”代表发送数据，“<=”代表接收数据，通过这个指示箭头可以很清晰地知道两个 IP 之间的通信情况。最右列又分为三小列，这些实时参数分别表示外部 IP 连接到本机 2 秒内、10 秒内和 40 秒内的平均流量值。
    -   另外，这个部分还有一个流量图形条，流量图形条是对流量大小的动态展示，以第一部分中的流量刻度为基准。通过这个流量图形条可以很方便地看出哪个 IP 的流量最大，进而迅速定位网络中可能出现的流量问题。
-   第三部分
    
    -   位于 iftop 输出的最下面，可以分为三行，其中，“TX”表示发送数据，“RX”表示接收数据，“TOTAL”表示发送和接收全部流量。与这三行对应的有三列，其中“cum”列表示从运行 iftop 到目前的发送、接收和总数据流量。“peak”列表示发送、接收以及总的流量峰值。“rates”列表示过去 2s、10s、40s 的平均流量值。
    
    ![](https://ask.qcloudimg.com/http-save/yehe-5449090/cdnhlayh3p.png?imageView2/2/w/1620)
    

1.  交互操作

在 `iftop` 的实时监控界面中，还可以对输出结果进行交互式操作，用于对输出信息进行整理和过滤，在上图所示界面中，按键 `“h”` 即可进入交互选项界面，如下图所示。`iftop` 的交互功能和 `Linux` 下的 `top` 命令非常类似，交互参数主要分为 `4` 个部分，分别是一般参数、主机显示参数、端口显示参数和输出排序参数。相关参数的含义如下表所示。

## **使用示例**

1.  显示网卡 eth0 的信息，主机通过 ip 显示

1.  显示端口号（添加 -P 参数，进入界面可通过 p 参数关闭）

1.  显示将输出以 byte 为单位显示网卡流量,默认是 bit

1.  显示流量进度条

1.  显示每个连接的总流量

1.  显示指定 ip 172.17.1.158 的流量

## **实战**

下面我们将通过找出最费流量的 IP 和端口号这一具体实例，来演示 iftop 强大的功能。

1.  进入界面

-   \-i 指定网卡，
-   \-n 代表主机通过ip显示不走DNS
-   \-N 只显示连接端口号，不显示端口对应的服务名称(不加会显示如ssh这样的服务名称，不便于排查)
-   \-B 指定显示单位为Kb，默认是bit，太小！
-   \-m 设置输出界面中最上面的流量刻度最大值，流量刻度分5个大段显示

进入后界面如下:

1.  按下 L 显示流量刻度

L 参数直接显示进度条，方便人类阅读。

1.  按下 T 显示总量

有个总数统计，看着方便！

1.  按下 3，根据最近 40s 统计排序

用平均值来统计最权威点

1.  按下 t，发送和接受合成一行

1.  多按几次 B，查看最近 2s、10s、40s 的统计

没错，图中的 172.17.1.158 就是我们找到的流量用得最多的 IP

1.  筛选指定 IP 172.17.1.158

按下 l, 输入172.17.1.158，出现如下

回车后生效

这下就只看到这个 IP 的流量监控了

1.  找到这个 IP 哪个端口流量用得最多

按下 p, 根据端口号显示

到这里，我们就学会了如何找出流量用得最多的 IP 和端口号。

> 本文转载自：「 博客园 」，原文：http://t.cn/A6tM3oLg ，版权归原作者所有。欢迎投稿，投稿邮箱: editor@hi-linux.com。

本文分享自微信公众号 - 运维之美（Hi-Linux），作者：雪山飞猪

原文出处及转载信息见文内详细说明，如有侵权，请联系 yunjia\_community@tencent.com 删除。

原始发表时间：2021-03-22

本文参与[腾讯云自媒体分享计划](https://cloud.tencent.com/developer/support-plan)，欢迎正在阅读的你也加入，一起分享。